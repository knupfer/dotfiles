* initializing
** packages
#+BEGIN_SRC emacs-lisp :tangle yes
  (require 'package)
  (setq package-archives nil)
  (setq package-enable-at-startup nil)
  (package-initialize)
#+END_SRC
** loadpath
#+BEGIN_SRC emacs-lisp :tangle yes
    (mapc (lambda (x) (add-to-list 'load-path x))
          '("~/git/haskell-emacs/"
            "~/git/liquid-haskell-mode/"))
#+END_SRC
** require packages
#+BEGIN_SRC emacs-lisp :tangle yes
  (mapc 'require '(haskell-emacs
                   haskell-font-lock
                   org
                   ace-jump-mode
                   company
                   liquid-haskell-mode))
#+END_SRC
** indentation
#+BEGIN_SRC emacs-lisp :tangle yes
(setq-default indent-tabs-mode nil)
#+END_SRC
** theming
#+BEGIN_SRC emacs-lisp :tangle yes
(load-theme 'deeper-blue)
#+END_SRC
** default layout
*** modes
#+BEGIN_SRC emacs-lisp :tangle yes
  (setq-default truncate-lines t)
  (display-time-mode t)
  (scroll-bar-mode -1)
  (fringe-mode '(0 . nil))
  (column-number-mode 1)
  (menu-bar-mode -1)
  (tool-bar-mode -1)
#+END_SRC
*** vars
#+BEGIN_SRC emacs-lisp :tangle yes
  (setq inhibit-startup-screen t
        visual-line-fringe-indicators '(nil right-curly-arrow)
        display-time-24hr-format t)
#+END_SRC
*** faces
#+BEGIN_SRC emacs-lisp :tangle yes
  (set-face-attribute 'mode-line nil
                      :background "#033"
                      :foreground "#9bb"
                      :box nil)
  (set-face-attribute 'mode-line-buffer-id nil
                      :foreground "#99dddd"
                      :box nil)
  (set-face-attribute 'mode-line-inactive nil
                      :inherit 'mode-line
                      :background "gray32"
                      :foreground "black"
                      :box nil
                      :weight 'light)
  (set-face-attribute 'default nil
                      :background "#000000"
                      :foreground "#ffffff")
  (set-face-attribute 'fringe nil
                      :background "black"
                      :foreground "#0ff")
  (set-face-attribute 'region nil
                      :background "#505")
  (set-face-attribute 'cursor nil
                      :background "#709")
  (set-face-attribute 'org-archived nil
                      :foreground "#254555")
  (set-face-attribute 'org-checkbox nil
                      :inherit 'bold
                      :foreground "#2f2")
  (set-face-attribute 'org-done nil
                      :foreground "#5f5"
                      :weight 'ultra-bold)
  (set-face-attribute 'org-hide nil
                      :foreground "#777")
  (set-face-attribute 'org-todo nil
                      :foreground "#faa"
                      :weight 'ultra-bold)
  (set-face-attribute 'outline-1 nil
                      :inherit 'font-lock-function-name-face
                      :foreground "SkyBlue1"
                      :weight 'bold)
  (make-face 'my-gnus-face-6)
  (set-face-attribute 'my-gnus-face-6 nil
                      :foreground "#9EE"
                      :background "#333"
                      :weight 'bold)
  (make-face 'my-gnus-face-7)
  (set-face-attribute 'my-gnus-face-7 nil
                      :foreground "#9EE"
                      :background "#333"
                      :weight 'bold
                      :box '(:line-width -1 :color "#555"))
  (set-face-attribute 'ace-jump-face-foreground nil
                      :background "black"
                      :foreground "green"
                      :weight 'bold)
#+END_SRC
** cursor
#+BEGIN_SRC emacs-lisp :tangle yes
  (blink-cursor-mode -1)
  (defvar hcz-set-cursor-color-color "")
  (defvar hcz-set-cursor-color-buffer "")
  (defun hcz-set-cursor-color-according-to-mode ()
    "change cursor color according to some minor modes."
    (let ((color (if (and (boundp 'knu-org-mode-map)
                          (org-inside-LaTeX-fragment-p)) "#2a6"
                   (if buffer-read-only "white"
                     (if overwrite-mode "#fa0"
                       "#909")))))
      (unless (and
               (string= color hcz-set-cursor-color-color)
               (string= (buffer-name) hcz-set-cursor-color-buffer))
        (set-cursor-color (setq hcz-set-cursor-color-color color))
        (setq hcz-set-cursor-color-buffer (buffer-name)))))
#+END_SRC
** key-map
#+BEGIN_SRC emacs-lisp :tangle yes
  (mapc (lambda (x) (define-key global-map (kbd (car x)) (cadr x)))
        '(("<M-left>" backward-sentence)
          ("<M-right>" forward-sentence)
          ("<M-backspace>" backward-kill-sentence)
          ("<M-delete>" kill-sentence)
          ("\C-cm" magit-status)
          ("S-SPC" ace-jump-mode)))
#+END_SRC
** nix-shell?
#+BEGIN_SRC emacs-lisp :tangle yes
(when (getenv "IN_NIX_SHELL")
  (set-face-background 'mode-line "#220")
  (set-face-foreground 'mode-line "#990")
  (set-face-foreground 'mode-line-buffer-id "#ff5"))
#+END_SRC
** root?
#+BEGIN_SRC emacs-lisp :tangle yes
(when (equal (getenv "USER") "root")
  (set-face-background 'mode-line "#400")
  (set-face-foreground 'mode-line "#b00")
  (set-face-foreground 'mode-line-buffer-id "#e55"))
#+END_SRC
* major-modes
** org
#+BEGIN_SRC emacs-lisp :tangle yes
  (setq org-time-clocksum-format '(:hours "%d"
                                          :require-hours t
                                          :minutes ":%02d"
                                          :require-minutes t))
  (setq org-catch-invisible-edits 'error
        org-confirm-babel-evaluate nil
        org-drawers '("PROPERTIES" "CLOCK" "LOGBOOK" "RESULTS" "INIT")
        org-export-backends '(ascii html latex odt)
        org-export-headline-levels 4
        org-format-latex-options '(:foreground "#0da"
                                               :background default
                                               :scale 2.0
                                               :html-foreground "Black"
                                               :html-background "Transparent"
                                               :html-scale 1.0
                                               :matchers ("begin" "$1" "$" "$$" "\\(" "\\["))
        org-highlight-latex-and-related '(latex script entities)
        org-image-actual-width 200
        org-latex-preview-ltxpng-directory "~/ltxpreview/"
        org-list-empty-line-terminates-plain-lists t
        org-log-done 'time
        org-src-fontify-natively t
        org-startup-folded t
        org-startup-indented t
        org-startup-with-inline-images t
        org-todo-keyword-faces '(("FAILED" . "#f00") ("CANCELED" . "#ee3") ("WAIT" . "#f0f"))
        org-todo-keywords '((sequence "TODO" "WAIT" "|" "DONE" "CANCELED" "FAILED"))
        org-format-latex-header "\\documentclass{article}
  \\usepackage[usenames]{color}
  \\usepackage{etoolbox}
  \\usepackage{mdframed}
  [PACKAGES]
  [DEFAULT-PACKAGES]
  \\pagestyle{empty}             % do not remove
  % The settings below are copied from fullpage.sty
  \\setlength{\\textwidth}{\\paperwidth}
  \\addtolength{\\textwidth}{-13cm}
  \\setlength{\\oddsidemargin}{1.5cm}
  \\addtolength{\\oddsidemargin}{-2.54cm}
  \\setlength{\\evensidemargin}{\\oddsidemargin}
  \\setlength{\\textheight}{\\paperheight}
  \\addtolength{\\textheight}{-\\headheight}
  \\addtolength{\\textheight}{-\\headsep}
  \\addtolength{\\textheight}{-\\footskip}
  \\addtolength{\\textheight}{-3cm}
  \\setlength{\\topmargin}{1.5cm}
  \\addtolength{\\topmargin}{-2.54cm}
  \\definecolor{bg}{rgb}{0,0.1,0.1}\\definecolor{fg}{rgb}{0.2,1,0.7}
  \\BeforeBeginEnvironment{align*}{\\begin{mdframed}[backgroundcolor=bg, innertopmargin=-0.2cm]\\color{fg}}
  \\AfterEndEnvironment{align*}{\\end{mdframed}}
  \\BeforeBeginEnvironment{align}{\\begin{mdframed}[backgroundcolor=bg, innertopmargin=-0.2cm]\\color{fg}}
  \\AfterEndEnvironment{align}{\\end{mdframed}}
  \\BeforeBeginEnvironment{gather*}{\\begin{mdframed}[backgroundcolor=bg, innertopmargin=-0.2cm]\\color{fg}}
  \\AfterEndEnvironment{gather*}{\\end{mdframed}}
  \\BeforeBeginEnvironment{gather}{\\begin{mdframed}[backgroundcolor=bg, innertopmargin=-0.2cm]\\color{fg}}
  \\AfterEndEnvironment{gather}{\\end{mdframed}}
  \\newenvironment{definition}{\\begin{mdframed}[backgroundcolor=bg]\\color{fg} \\textbf{\\textsc{Definition:}} }{\\end{mdframed}}
  \\newenvironment{note}{\\begin{mdframed}[backgroundcolor=bg]\\color{fg} \\textbf{\\textsc{Bemerkung:}} }{\\end{mdframed}}
  \\newenvironment{example}{\\begin{mdframed}[backgroundcolor=bg]\\color{fg} \\textbf{\\textsc{Beispiel:}} }{\\end{mdframed}}
  \\newcommand{\\e}{\\mathrm{e}}")
#+END_SRC
** erc
#+BEGIN_SRC emacs-lisp :tangle yes
(setq erc-nick "knupfer"
      erc-prompt ">>>"
      erc-prompt-for-password nil
      erc-system-name "knupfer"
      erc-timestamp-right-column 70)
#+END_SRC
** gnus
#+BEGIN_SRC emacs-lisp :tangle yes
  (setq send-mail-function 'mailclient-send-it
        user-full-name "Florian Knupfer"
        user-mail-address "fknupfer@gmail.com"
        message-generate-headers-first t
        message-send-mail-function 'smtpmail-send-it
        smtpmail-starttls-credentials '(("smtp.gmail.com" 587 nil nil))
        smtpmail-auth-credentials '(("smtp.gmail.com" 587
                                     "fknupfer@gmail.com" nil))
        smtpmail-default-smtp-server "smtp.gmail.com"
        smtpmail-smtp-server "smtp.gmail.com"
        smtpmail-smtp-service 587
        starttls-use-gnutls t
        mail-user-agent 'gnus-user-agent
        gnus-default-adaptive-word-score-alist '((82 . 1) (67 . -1)
                                                 (75 . -2) (114 . -1))
        gnus-treat-fill-article t
        gnus-treat-leading-whitespace t
        gnus-treat-strip-multiple-blank-lines t
        gnus-treat-strip-trailing-blank-lines t
        gnus-treat-unsplit-urls t)

  (eval-after-load "mm-decode"
    '(progn
       (add-to-list 'mm-discouraged-alternatives "text/html")
       (add-to-list 'mm-discouraged-alternatives "text/richtext")))

  (eval-after-load 'gnus
    '(progn
       (setq gnus-select-method '(nnimap "gmail"
                                         (nnimap-address "imap.gmail.com")
                                         (nnimap-server-port 993)
                                         (nnimap-stream ssl)))

       (add-to-list 'gnus-secondary-select-methods
                    '(nntp "eternal september"
                           (nntp-address "reader443.eternal-september.org")
                           (nntp-authinfo-force t)))
       (add-to-list 'gnus-secondary-select-methods
                    '(nntp "gmane"
                           (nntp-address "news.gmane.org")))
       (add-to-list 'gnus-secondary-select-methods
                    '(nnimap "Musikschule"
                             (nnimap-address "secure.emailsrvr.com")
                             (nnimap-server-port 993)
                             (nnimap-stream ssl)))

       (setq-default gnus-summary-mark-below -300
                     gnus-summary-thread-gathering-function 'gnus-gather-threads-by-references)
       (setq gnus-face-5 'font-lock-comment-face)
       (setq gnus-face-6 'my-gnus-face-6)
       (setq gnus-face-7 'my-gnus-face-7)
       (setq gnus-summary-thread-gathering-function 'gnus-gather-threads-by-subject
             gnus-thread-sort-functions '((not gnus-thread-sort-by-date))
             gnus-summary-line-format
             "%U%R%z %5{│%}%6{ %d %}%5{│%} %-23,23f %5{│%}%* %5{%B%}%s\\n"
             gnus-sum-thread-tree-false-root "• "
             gnus-sum-thread-tree-indent "  "
             gnus-sum-thread-tree-single-indent "  "
             gnus-sum-thread-tree-leaf-with-other "├─▶ "
             gnus-sum-thread-tree-root "• "
             gnus-sum-thread-tree-single-leaf "└─▶ "
             gnus-sum-thread-tree-vertical "│ "
             gnus-group-line-format "%M%S%p%P%5y:%B%(%G%)\n"
             gnus-posting-styles '((message-news-p
                                    (name "quxbam")
                                    (address "no@news.invalid"))))
       (setq gnus-use-adaptive-scoring '(word))
       (setq gnus-parameters
             '(("WIKI"
                (gnus-summary-line-format
                 "%U%R %5{│%}%6{ %5,5i %}%5{│%}%* %-40,40f %5{│ %s%}\\n")
                (gnus-article-sort-functions '(gnus-article-sort-by-author gnus-article-sort-by-subject gnus-article-sort-by-score))
                (gnus-show-threads nil))
               ("musikschule"
                (gnus-article-sort-functions '((not gnus-article-sort-by-date)))
                (gnus-show-threads nil))))
       (setq nnml-use-compressed-files t
             gnus-topic-display-empty-topics nil
             gnus-topic-line-format "%i%i%7{ %(%-12n%)%7A %}\n")
       (add-hook 'gnus-group-mode-hook 'gnus-topic-mode)
       (add-hook 'dired-mode-hook 'turn-on-gnus-dired-mode)))
       (add-hook 'gnus-article-mode-hook (lambda ()
                 (face-remap-add-relative 'default '(:family "Linux Biolinum O" :height 120))))
       (add-hook 'message-mode-hook (lambda ()
                 (face-remap-add-relative 'default '(:family "Linux Biolinum O" :height 120))))
#+END_SRC
* minor-modes
** shakespeare
#+BEGIN_SRC emacs-lisp :tangle yes
(add-to-list 'auto-mode-alist '("\\.hamlet\\'" . shakespeare-hamlet-mode))
(add-to-list 'auto-mode-alist '("\\.julius\\'" . shakespeare-julius-mode))
#+END_SRC
** fill-column-indicator
#+BEGIN_SRC emacs-lisp :tangle yes
(setq fci-always-use-textual-rule t
      fci-rule-column 80
      fci-rule-color "#cc0000")
#+END_SRC
** autocomplete
#+BEGIN_SRC emacs-lisp :tangle yes
(setq ac-override-local-map nil
      ac-use-menu-map t
      ac-candidate-limit 20)
#+END_SRC
** flycheck
#+BEGIN_SRC emacs-lisp :tangle yes
  (global-flycheck-mode 1)
  (set-face-attribute 'flycheck-error nil
                      :foreground "#D00"
                      :background "#222"
                      :underline nil
                      :weight 'ultrabold)
  (set-face-attribute 'flycheck-warning nil
                      :foreground "#CC0"
                      :background "#222"
                      :underline nil
                      :weight 'ultrabold)
  (set-face-attribute 'flycheck-info nil
                      :foreground "#66F"
                      :background "#008"
                      :underline nil
                      :weight 'ultrabold)
#+END_SRC
** whitespace
#+BEGIN_SRC emacs-lisp :tangle yes
(setq whitespace-style '(face trailing tabs)
      whitespace-tab-regexp "\\(\\\\alpha\\|\\\\beta\\|\\\\gamma\\|\\\\mu\\|\\\\nu\\|\\\\epsilon\\|\\\\lambda\\|\\\\sigma\\|\\\\tau\\|\\\\eta\\|\\\\omega\\|\\\\theta\\|\\\\rho\\|\\\\phi\\|\\\\psi\\|\\\\upsilon\\|\\\\pi\\|\\\\delta\\|\\\\kappa\\|\\\\xi\\|\\\\chi\\|\\\\Pi\\|\\\\Phi\\|\\\\Gamma\\|\\\\Omega\\|\\\\Lambda\\|\\\\nabla\\|\\\\Delta\\|\\\\int\\|\\\\oint\\|\\\\times\\|\\\\cdot\\|\\\\sum\\|\\\\pm\\|\\\\mp\\|\\\\geq\\|\\\\leq\\|\\\\neq\\|\\\\approx\\|\\\\rightarrow\\|\\\\leftarrow\\|\\\\Rightarrow\\|\\\\Leftarrow\\|\\\\mapsto\\|\\\\curvearrowright\\|\\\\leftrightarrow\\|\\\\mathrm{d}\\|\\\\infty\\|\\\\partial\\|\\\\equiv\\|\\\\ll\\|IO \\|\\\\underline\\)")
(eval-after-load 'whitespace
  '(set-face-attribute 'whitespace-tab nil
                       :background "nil"
                       :foreground "#00eeaa"
                       :weight 'ultra-bold))
#+END_SRC
** paredit
*** key-map
#+BEGIN_SRC emacs-lisp :tangle yes
(eval-after-load 'paredit
  '(mapc (lambda (x) (define-key paredit-mode-map (kbd (car x)) (cadr x)))
         '(("<C-right>" nil)
           ("<C-left>" nil)
           ("<M-right>" paredit-forward)
           ("<M-left>" paredit-backward)
           ("<C-up>" paredit-forward-barf-sexp)
           ("<C-down>" paredit-forward-slurp-sexp)
           ("<M-up>" paredit-backward-slurp-sexp)
           ("<M-down>" paredit-backward-barf-sexp)
           ("<M-backspace>" backward-kill-sexp)
           ("<M-delete>" kill-sexp)
           ("<tab>" completion-at-point)
           ("<RET>" paredit-newline)
           ("<C-backspace>" paredit-backward-kill-word)
           ("<C-delete>" paredit-forward-kill-word)
           ("{" paredit-open-curly)
           ("}" paredit-close-curly))))
#+END_SRC
* misc
** inits
#+BEGIN_SRC emacs-lisp :tangle yes
(global-whitespace-mode)
#+END_SRC
** hooks
#+BEGIN_SRC emacs-lisp :tangle yes
    (add-hook 'haskell-mode-hook (lambda ()
              (face-remap-add-relative 'default '(:family "Hasklig"))
              (setq prettify-symbols-alist
                    (list (cons "&&" (decode-char 'ucs #XE100))
                          (cons "***" (decode-char 'ucs #XE101))
                          (cons "*>" (decode-char 'ucs #XE102))
                          (cons "\\\\" (decode-char 'ucs #XE103))
                          (cons "||" (decode-char 'ucs #XE104))
                          (cons "|>" (decode-char 'ucs #XE105))
                          (cons "::" (decode-char 'ucs #XE106))
                          (cons "==" (decode-char 'ucs #XE107))
                          (cons "===" (decode-char 'ucs #XE108))
                          (cons "==>" (decode-char 'ucs #XE109))
                          (cons "=>" (decode-char 'ucs #XE10A))
                          (cons "=<<" (decode-char 'ucs #XE10B))
                          (cons "!!" (decode-char 'ucs #XE10C))
                          (cons ">>" (decode-char 'ucs #XE10D))
                          (cons ">>=" (decode-char 'ucs #XE10E))
                          (cons ">>>" (decode-char 'ucs #XE10F))
                          (cons ">>-" (decode-char 'ucs #XE110))
                          (cons ">-" (decode-char 'ucs #XE111))
                          (cons "->" (decode-char 'ucs #XE112))
                          (cons "-<" (decode-char 'ucs #XE113))
                          (cons "-<<" (decode-char 'ucs #XE114))
                          (cons "<*" (decode-char 'ucs #XE115))
                          (cons "<*>" (decode-char 'ucs #XE116))
                          (cons "<|" (decode-char 'ucs #XE117))
                          (cons "<|>" (decode-char 'ucs #XE118))
                          (cons "<$>" (decode-char 'ucs #XE119))
                          (cons "<>" (decode-char 'ucs #XE11A))
                          (cons "<-" (decode-char 'ucs #XE11B))
                          (cons "<<" (decode-char 'ucs #XE11C))
                          (cons "<<<" (decode-char 'ucs #XE11D))
                          (cons "<+>" (decode-char 'ucs #XE11E))
                          (cons ".." (decode-char 'ucs #XE11F))
                          (cons "..." (decode-char 'ucs #XE120))
                          (cons "++" (decode-char 'ucs #XE121))
                          (cons "+++" (decode-char 'ucs #XE122))
                          (cons "\\" 955)
                          (cons "*" 215)
                          (cons "/=" (decode-char 'ucs #XE123))))
                                   (prettify-symbols-mode)
                                   (buffer-file-name)
                                   (ghc-init)
                                   (company-mode)
                                   (liquid-haskell-mode)))
    (add-to-list 'company-backends 'company-ghc)
    (add-to-list 'company-backends 'company-nixos-options)
    (add-hook 'kill-emacs-hook (lambda ()
                                   (when (fboundp 'gnus-group-exit)
                                     (defun gnus-y-or-n-p (yes) yes)
                                     (gnus-group-exit))))
    (add-hook 'ibuffer-mode-hook 'ibuffer-auto-mode)
    (add-hook 'org-mode-hook (lambda ()
                                 (auto-fill-mode)
                                 (whitespace-mode)))
    (add-hook 'post-command-hook 'hcz-set-cursor-color-according-to-mode)
    (add-hook 'emacs-lisp-mode-hook 'paredit-mode)
    (add-hook 'nix-mode-hook 'company-mode)
#+END_SRC
** tramp
#+BEGIN_SRC emacs-lisp :tangle yes
  (setq tramp-default-method "ssh"
        tramp-default-method-alist
        '(("80\\.240\\.140\\.83#50683" "quxbar" "scpc") (nil "%" "smb")
          ("\\`\\(127\\.0\\.0\\.1\\|::1\\|localhost6?\\)\\'"
           "\\`root\\'" "su")
          (nil "\\`\\(anonymous\\|ftp\\)\\'" "ftp") ("\\`ftp\\." nil "ftp"))
        tramp-default-proxies-alist
        '(("80.240.140.83#50683" "root" "/ssh:quxbar@80.240.140.83#50683:")))
#+END_SRC
** misc
#+BEGIN_SRC emacs-lisp :tangle yes
  (defalias 'yes-or-no-p 'y-or-n-p)
  (setq kill-do-not-save-duplicates t)
#+END_SRC
* Customize
#+BEGIN_SRC emacs-lisp :tangle yes
  (setq custom-file "/dev/null")
#+END_SRC
